"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = __importDefault(require("fs"));
const https_1 = __importDefault(require("https"));
const path_1 = __importDefault(require("path"));
const url_1 = require("url");
const crypto_1 = __importDefault(require("crypto"));
const file_1 = require("./file");
const FILE_SUFFIX = [".png", ".jpg", ".jpeg"];
const MAX_FILE_SIZE = 5 * 1024 * 1024;
const TINYPNG_CACHE_FILE = path_1.default.join(Editor.Project.path, "caches/tinypng.json");
const OPTIONS = {
    method: "POST",
    hostname: "tinypng.com",
    path: "/backend/opt/shrink",
    headers: {
        rejectUnauthorized: false,
        "Postman-Token": Date.now(),
        "Cache-Control": "no-cache",
        "Content-Type": "application/x-www-form-urlencoded",
        "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36",
    },
};
function getRandomIP() {
    return Array.from({ length: 4 }, () => Math.floor(Math.random() * 255)).join(".");
}
function fileEach(dir, callback) {
    try {
        const files = fs_1.default.readdirSync(dir);
        files.forEach((file) => {
            const filePath = path_1.default.join(dir, file);
            const stats = fs_1.default.statSync(filePath);
            if (stats.isDirectory()) {
                fileEach(filePath, callback);
            }
            else if (
            // 必须是文件，小于5MB，后缀 jpg 或 png
            stats.size <= MAX_FILE_SIZE &&
                stats.isFile() &&
                FILE_SUFFIX.includes(path_1.default.extname(file))) {
                callback(filePath);
            }
        });
    }
    catch (err) {
        console.error(err);
    }
}
function getFileHash(filePath) {
    const fileBuffer = fs_1.default.readFileSync(filePath);
    const hashSum = crypto_1.default.createHash("md5");
    hashSum.update(fileBuffer);
    return hashSum.digest("hex");
}
function loadCache() {
    if (fs_1.default.existsSync(TINYPNG_CACHE_FILE)) {
        const cacheData = fs_1.default.readFileSync(TINYPNG_CACHE_FILE, "utf-8");
        return JSON.parse(cacheData);
    }
    return {};
}
function saveCache(cache) {
    (0, file_1.ensureDirectoryExistence)(TINYPNG_CACHE_FILE);
    fs_1.default.writeFileSync(TINYPNG_CACHE_FILE, JSON.stringify(cache, null, 2));
}
async function fileUpload(imgPath) {
    return new Promise((resolve, reject) => {
        OPTIONS.headers["X-Forwarded-For"] = getRandomIP();
        const req = https_1.default.request(OPTIONS, (res) => {
            let data = "";
            res.on("data", (chunk) => {
                data += chunk;
            });
            res.on("end", () => {
                try {
                    const parsedData = JSON.parse(data);
                    if (parsedData.error) {
                        reject(new Error(parsedData.message));
                    }
                    else {
                        resolve(parsedData);
                    }
                }
                catch (error) {
                    reject(new Error("Failed to parse response JSON"));
                }
            });
        });
        req.on("error", reject);
        const fileStream = fs_1.default.createReadStream(imgPath);
        fileStream.on("error", (err) => {
            req.destroy(err);
            reject(err);
        });
        fileStream.on("end", () => {
            req.end();
        });
        fileStream.pipe(req);
    });
}
async function fileUpdate(imgPath, resp) {
    return new Promise((resolve, reject) => {
        const options = new url_1.URL(resp.output.url);
        const req = https_1.default.request(options, (res) => {
            const fileStream = fs_1.default.createWriteStream(imgPath, { encoding: "binary" });
            res.setEncoding("binary");
            res.pipe(fileStream);
            fileStream.on("finish", () => resolve(resp));
            fileStream.on("error", (err) => {
                req.destroy(err);
                reject(err);
            });
        });
        req.on("error", reject);
        req.end();
    });
}
function toSize(b) {
    if (b < 1024) {
        return b + "B";
    }
    else if (b < 1024 * 1024) {
        return (b / 1024).toFixed(2) + "KB";
    }
    else {
        return (b / 1024 / 1024).toFixed(2) + "MB";
    }
}
function toPercent(num) {
    return (num * 100).toFixed(2) + "%";
}
async function fileTiny(filePath) {
    try {
        const response = await fileUpload(filePath);
        return await fileUpdate(filePath, response);
    }
    catch (error) {
        throw error;
    }
}
async function default_1(dir) {
    if (!fs_1.default.existsSync(dir)) {
        console.error(`目录不存在：${dir}`);
        return;
    }
    const cache = loadCache();
    const basename = path_1.default.basename(dir);
    console.log(`[${basename}] 压缩中...`);
    const stats = fs_1.default.statSync(dir);
    if (stats.isFile()) {
        const ext = path_1.default.extname(dir);
        if (!FILE_SUFFIX.includes(ext)) {
            console.log(`[${basename}] 压缩失败：只支持png、jpg与jpeg格式`);
            return;
        }
        const fileHash = getFileHash(dir);
        if (cache[dir] === fileHash) {
            console.log(`[${basename}] 已经压缩过，跳过`);
            return;
        }
        try {
            const resp = await fileTiny(dir);
            cache[dir] = getFileHash(dir);
            saveCache(cache);
            console.log("[1/1]", `[${basename}]`, `压缩成功，原始大小：${toSize(resp.input.size)}，压缩大小：${toSize(resp.output.size)}，压缩了：${toPercent((resp.input.size - resp.output.size) / resp.input.size)}`);
        }
        catch (err) {
            console.log("[1/1]", `[${basename}]`, `压缩失败：${err}`);
        }
    }
    else if (stats.isDirectory()) {
        let total = 0;
        let finished = 0;
        fileEach(dir, async (filePath) => {
            const relativePath = path_1.default.join(basename, path_1.default.relative(dir, filePath));
            const fileHash = getFileHash(filePath);
            if (cache[filePath] === fileHash) {
                console.log(`[${relativePath}] 已经压缩过，跳过`);
                return;
            }
            total++;
            try {
                const resp = await fileTiny(filePath);
                cache[filePath] = getFileHash(filePath);
                saveCache(cache);
                console.log(`[${++finished}/${total}]`, `[${relativePath}]`, `压缩成功，原始大小：${toSize(resp.input.size)}，压缩大小：${toSize(resp.output.size)}，压缩了：${toPercent((resp.input.size - resp.output.size) / resp.input.size)}`);
            }
            catch (err) {
                console.log(`[${++finished}/${total}]`, `[${relativePath}]`, `压缩失败：${err}`);
            }
        });
    }
}
exports.default = default_1;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGlueS1wbmcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvdXRpbHMvdGlueS1wbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw0Q0FBb0I7QUFDcEIsa0RBQTBCO0FBQzFCLGdEQUF3QjtBQUN4Qiw2QkFBMEI7QUFDMUIsb0RBQTRCO0FBQzVCLGlDQUFrRDtBQUVsRCxNQUFNLFdBQVcsR0FBRyxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDOUMsTUFBTSxhQUFhLEdBQUcsQ0FBQyxHQUFHLElBQUksR0FBRyxJQUFJLENBQUM7QUFDdEMsTUFBTSxrQkFBa0IsR0FBRyxjQUFJLENBQUMsSUFBSSxDQUNsQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFDbkIscUJBQXFCLENBQ3RCLENBQUM7QUFtQkYsTUFBTSxPQUFPLEdBQUc7SUFDZCxNQUFNLEVBQUUsTUFBTTtJQUNkLFFBQVEsRUFBRSxhQUFhO0lBQ3ZCLElBQUksRUFBRSxxQkFBcUI7SUFDM0IsT0FBTyxFQUFFO1FBQ1Asa0JBQWtCLEVBQUUsS0FBWTtRQUNoQyxlQUFlLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRTtRQUMzQixlQUFlLEVBQUUsVUFBVTtRQUMzQixjQUFjLEVBQUUsbUNBQW1DO1FBQ25ELFlBQVksRUFDVix1SEFBdUg7S0FDMUg7Q0FDc0IsQ0FBQztBQUUxQixTQUFTLFdBQVc7SUFDbEIsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUMxRSxHQUFHLENBQ0osQ0FBQztBQUNKLENBQUM7QUFFRCxTQUFTLFFBQVEsQ0FBQyxHQUFXLEVBQUUsUUFBbUM7SUFDaEUsSUFBSTtRQUNGLE1BQU0sS0FB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Q0FBQztnQkFDMUMsT0FBTzthQUNSO1lBQ0QsS0FBSyxFQUFFLENBQUM7WUFDUixJQUFJO2dCQUNGLE1BQU0sSUFBSSxHQUFHLE1BQU0sUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUN0QyxLQUFLLENBQUMsUUFBUSxDQUFDLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUN4QyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ2pCLE9BQU8sQ0FBQyxHQUFHLENBQ1QsSUFBSSxFQUFFLFFBQVEsSUFBSSxLQUFLLEdBQUcsRUFDMUIsSUFBSSxZQUFZLEdBQUcsRUFDbkIsYUFBYSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxNQUFNLENBQ2pELElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUNqQixRQUFRLFNBQVMsQ0FDaEIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUN2RCxFQUFFLENBQ0osQ0FBQzthQUNIO1lBQUMsT0FBTyxHQUFHLEVBQUU7Z0JBQ1osT0FBTyxDQUFDLEdBQUcsQ0FDVCxJQUFJLEVBQUUsUUFBUSxJQUFJLEtBQUssR0FBRyxFQUMxQixJQUFJLFlBQVksR0FBRyxFQUNuQixRQUFRLEdBQUcsRUFBRSxDQUNkLENBQUM7YUFDSDtRQUNILENBQUMsQ0FBQyxDQUFDO0tBQ0o7QUFDSCxDQUFDO0FBckVELDRCQXFFQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmcyBmcm9tIFwiZnNcIjtcbmltcG9ydCBodHRwcyBmcm9tIFwiaHR0cHNcIjtcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgeyBVUkwgfSBmcm9tIFwidXJsXCI7XG5pbXBvcnQgY3J5cHRvIGZyb20gXCJjcnlwdG9cIjtcbmltcG9ydCB7IGVuc3VyZURpcmVjdG9yeUV4aXN0ZW5jZSB9IGZyb20gXCIuL2ZpbGVcIjtcblxuY29uc3QgRklMRV9TVUZGSVggPSBbXCIucG5nXCIsIFwiLmpwZ1wiLCBcIi5qcGVnXCJdO1xuY29uc3QgTUFYX0ZJTEVfU0laRSA9IDUgKiAxMDI0ICogMTAyNDtcbmNvbnN0IFRJTllQTkdfQ0FDSEVfRklMRSA9IHBhdGguam9pbihcbiAgRWRpdG9yLlByb2plY3QucGF0aCxcbiAgXCJjYWNoZXMvdGlueXBuZy5qc29uXCJcbik7XG5cbmludGVyZmFjZSBJUmVzcG9uc2Uge1xuICBpbnB1dDoge1xuICAgIHNpemU6IG51bWJlcjtcbiAgICB0eXBlOiBzdHJpbmc7XG4gIH07XG4gIG91dHB1dDoge1xuICAgIHNpemU6IG51bWJlcjtcbiAgICB0eXBlOiBzdHJpbmc7XG4gICAgd2lkdGg6IG51bWJlcjtcbiAgICBoZWlnaHQ6IG51bWJlcjtcbiAgICByYXRpbzogbnVtYmVyO1xuICAgIHVybDogc3RyaW5nO1xuICB9O1xuICBlcnJvcjogc3RyaW5nO1xuICBtZXNzYWdlOiBzdHJpbmc7XG59XG5cbmNvbnN0IE9QVElPTlMgPSB7XG4gIG1ldGhvZDogXCJQT1NUXCIsXG4gIGhvc3RuYW1lOiBcInRpbnlwbmcuY29tXCIsXG4gIHBhdGg6IFwiL2JhY2tlbmQvb3B0L3Nocmlua1wiLFxuICBoZWFkZXJzOiB7XG4gICAgcmVqZWN0VW5hdXRob3JpemVkOiBmYWxzZSBhcyBhbnksXG4gICAgXCJQb3N0bWFuLVRva2VuXCI6IERhdGUubm93KCksXG4gICAgXCJDYWNoZS1Db250cm9sXCI6IFwibm8tY2FjaGVcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiLFxuICAgIFwiVXNlci1BZ2VudFwiOlxuICAgICAgXCJNb3ppbGxhLzUuMCAoTWFjaW50b3NoOyBJbnRlbCBNYWMgT1MgWCAxMF8xNV83KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTI3LjAuMC4wIFNhZmFyaS81MzcuMzZcIixcbiAgfSxcbn0gYXMgaHR0cHMuUmVxdWVzdE9wdGlvbnM7XG5cbmZ1bmN0aW9uIGdldFJhbmRvbUlQKCkge1xuICByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogNCB9LCAoKSA9PiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyNTUpKS5qb2luKFxuICAgIFwiLlwiXG4gICk7XG59XG5cbmZ1bmN0aW9uIGZpbGVFYWNoKGRpcjogc3RyaW5nLCBjYWxsYmFjazogKGZpbGVQYXRoOiBzdHJpbmcpID0+IGFueSkge1xuICB0cnkge1xuICAgIGNvbnN0IGZpbGVzID0gZnMucmVhZGRpclN5bmMoZGlyKTtcbiAgICBmaWxlcy5mb3JFYWNoKChmaWxlKSA9PiB7XG4gICAgICBjb25zdCBmaWxlUGF0aCA9IHBhdGguam9pbihkaXIsIGZpbGUpO1xuICAgICAgY29uc3Qgc3RhdHMgPSBmcy5zdGF0U3luYyhmaWxlUGF0aCk7XG4gICAgICBpZiAoc3RhdHMuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICBmaWxlRWFjaChmaWxlUGF0aCwgY2FsbGJhY2spO1xuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgLy8g5b+F6aG75piv5paH5Lu277yM5bCP5LqONU1C77yM5ZCO57yAIGpwZyDmiJYgcG5nXG4gICAgICAgIHN0YXRzLnNpemUgPD0gTUFYX0ZJTEVfU0laRSAmJlxuICAgICAgICBzdGF0cy5pc0ZpbGUoKSAmJlxuICAgICAgICBGSUxFX1NVRkZJWC5pbmNsdWRlcyhwYXRoLmV4dG5hbWUoZmlsZSkpXG4gICAgICApIHtcbiAgICAgICAgY2FsbGJhY2soZmlsZVBhdGgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKGVycik7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0RmlsZUhhc2goZmlsZVBhdGg6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IGZpbGVCdWZmZXIgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZVBhdGgpO1xuICBjb25zdCBoYXNoU3VtID0gY3J5cHRvLmNyZWF0ZUhhc2goXCJtZDVcIik7XG4gIGhhc2hTdW0udXBkYXRlKGZpbGVCdWZmZXIpO1xuICByZXR1cm4gaGFzaFN1bS5kaWdlc3QoXCJoZXhcIik7XG59XG5cbmZ1bmN0aW9uIGxvYWRDYWNoZSgpOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+IHtcbiAgaWYgKGZzLmV4aXN0c1N5bmMoVElOWVBOR19DQUNIRV9GSUxFKSkge1xuICAgIGNvbnN0IGNhY2hlRGF0YSA9IGZzLnJlYWRGaWxlU3luYyhUSU5ZUE5HX0NBQ0hFX0ZJTEUsIFwidXRmLThcIik7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UoY2FjaGVEYXRhKTtcbiAgfVxuICByZXR1cm4ge307XG59XG5cbmZ1bmN0aW9uIHNhdmVDYWNoZShjYWNoZTogUmVjb3JkPHN0cmluZywgc3RyaW5nPikge1xuICBlbnN1cmVEaXJlY3RvcnlFeGlzdGVuY2UoVElOWVBOR19DQUNIRV9GSUxFKTtcbiAgZnMud3JpdGVGaWxlU3luYyhUSU5ZUE5HX0NBQ0hFX0ZJTEUsIEpTT04uc3RyaW5naWZ5KGNhY2hlLCBudWxsLCAyKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGZpbGVVcGxvYWQoaW1nUGF0aDogc3RyaW5nKTogUHJvbWlzZTxJUmVzcG9uc2U+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBPUFRJT05TLmhlYWRlcnMhW1wiWC1Gb3J3YXJkZWQtRm9yXCJdID0gZ2V0UmFuZG9tSVAoKTtcbiAgICBjb25zdCByZXEgPSBodHRwcy5yZXF1ZXN0KE9QVElPTlMsIChyZXMpID0+IHtcbiAgICAgIGxldCBkYXRhID0gXCJcIjtcbiAgICAgIHJlcy5vbihcImRhdGFcIiwgKGNodW5rKSA9PiB7XG4gICAgICAgIGRhdGEgKz0gY2h1bms7XG4gICAgICB9KTtcbiAgICAgIHJlcy5vbihcImVuZFwiLCAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgcGFyc2VkRGF0YSA9IEpTT04ucGFyc2UoZGF0YSkgYXMgSVJlc3BvbnNlO1xuICAgICAgICAgIGlmIChwYXJzZWREYXRhLmVycm9yKSB7XG4gICAgICAgICAgICByZWplY3QobmV3IEVycm9yKHBhcnNlZERhdGEubWVzc2FnZSkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlKHBhcnNlZERhdGEpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKFwiRmFpbGVkIHRvIHBhcnNlIHJlc3BvbnNlIEpTT05cIikpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICByZXEub24oXCJlcnJvclwiLCByZWplY3QpO1xuICAgIGNvbnN0IGZpbGVTdHJlYW0gPSBmcy5jcmVhdGVSZWFkU3RyZWFtKGltZ1BhdGgpO1xuXG4gICAgZmlsZVN0cmVhbS5vbihcImVycm9yXCIsIChlcnIpID0+IHtcbiAgICAgIHJlcS5kZXN0cm95KGVycik7XG4gICAgICByZWplY3QoZXJyKTtcbiAgICB9KTtcbiAgICBmaWxlU3RyZWFtLm9uKFwiZW5kXCIsICgpID0+IHtcbiAgICAgIHJlcS5lbmQoKTtcbiAgICB9KTtcbiAgICBmaWxlU3RyZWFtLnBpcGUocmVxKTtcbiAgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGZpbGVVcGRhdGUoXG4gIGltZ1BhdGg6IHN0cmluZyxcbiAgcmVzcDogSVJlc3BvbnNlXG4pOiBQcm9taXNlPElSZXNwb25zZT4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGNvbnN0IG9wdGlvbnMgPSBuZXcgVVJMKHJlc3Aub3V0cHV0LnVybCk7XG4gICAgY29uc3QgcmVxID0gaHR0cHMucmVxdWVzdChvcHRpb25zLCAocmVzKSA9PiB7XG4gICAgICBjb25zdCBmaWxlU3RyZWFtID0gZnMuY3JlYXRlV3JpdGVTdHJlYW0oaW1nUGF0aCwgeyBlbmNvZGluZzogXCJiaW5hcnlcIiB9KTtcbiAgICAgIHJlcy5zZXRFbmNvZGluZyhcImJpbmFyeVwiKTtcbiAgICAgIHJlcy5waXBlKGZpbGVTdHJlYW0pO1xuICAgICAgZmlsZVN0cmVhbS5vbihcImZpbmlzaFwiLCAoKSA9PiByZXNvbHZlKHJlc3ApKTtcbiAgICAgIGZpbGVTdHJlYW0ub24oXCJlcnJvclwiLCAoZXJyKSA9PiB7XG4gICAgICAgIHJlcS5kZXN0cm95KGVycik7XG4gICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmVxLm9uKFwiZXJyb3JcIiwgcmVqZWN0KTtcbiAgICByZXEuZW5kKCk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiB0b1NpemUoYjogbnVtYmVyKSB7XG4gIGlmIChiIDwgMTAyNCkge1xuICAgIHJldHVybiBiICsgXCJCXCI7XG4gIH0gZWxzZSBpZiAoYiA8IDEwMjQgKiAxMDI0KSB7XG4gICAgcmV0dXJuIChiIC8gMTAyNCkudG9GaXhlZCgyKSArIFwiS0JcIjtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gKGIgLyAxMDI0IC8gMTAyNCkudG9GaXhlZCgyKSArIFwiTUJcIjtcbiAgfVxufVxuXG5mdW5jdGlvbiB0b1BlcmNlbnQobnVtOiBudW1iZXIpIHtcbiAgcmV0dXJuIChudW0gKiAxMDApLnRvRml4ZWQoMikgKyBcIiVcIjtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZmlsZVRpbnkoZmlsZVBhdGg6IHN0cmluZykge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmlsZVVwbG9hZChmaWxlUGF0aCk7XG4gICAgcmV0dXJuIGF3YWl0IGZpbGVVcGRhdGUoZmlsZVBhdGgsIHJlc3BvbnNlKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiAoZGlyOiBzdHJpbmcpIHtcbiAgaWYgKCFmcy5leGlzdHNTeW5jKGRpcikpIHtcbiAgICBjb25zb2xlLmVycm9yKGDnm67lvZXkuI3lrZjlnKjvvJoke2Rpcn1gKTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgY2FjaGUgPSBsb2FkQ2FjaGUoKTtcbiAgY29uc3QgYmFzZW5hbWUgPSBwYXRoLmJhc2VuYW1lKGRpcik7XG4gIGNvbnNvbGUubG9nKGBbJHtiYXNlbmFtZX1dIOWOi+e8qeS4rS4uLmApO1xuICBjb25zdCBzdGF0cyA9IGZzLnN0YXRTeW5jKGRpcik7XG4gIGlmIChzdGF0cy5pc0ZpbGUoKSkge1xuICAgIGNvbnN0IGV4dCA9IHBhdGguZXh0bmFtZShkaXIpO1xuICAgIGlmICghRklMRV9TVUZGSVguaW5jbHVkZXMoZXh0KSkge1xuICAgICAgY29uc29sZS5sb2coYFske2Jhc2VuYW1lfV0g5Y6L57yp5aSx6LSl77ya5Y+q5pSv5oyBcG5n44CBanBn5LiOanBlZ+agvOW8j2ApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBmaWxlSGFzaCA9IGdldEZpbGVIYXNoKGRpcik7XG4gICAgaWYgKGNhY2hlW2Rpcl0gPT09IGZpbGVIYXNoKSB7XG4gICAgICBjb25zb2xlLmxvZyhgWyR7YmFzZW5hbWV9XSDlt7Lnu4/ljovnvKnov4fvvIzot7Pov4dgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3AgPSBhd2FpdCBmaWxlVGlueShkaXIpO1xuICAgICAgY2FjaGVbZGlyXSA9IGdldEZpbGVIYXNoKGRpcik7XG4gICAgICBzYXZlQ2FjaGUoY2FjaGUpO1xuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIFwiWzEvMV1cIixcbiAgICAgICAgYFske2Jhc2VuYW1lfV1gLFxuICAgICAgICBg5Y6L57yp5oiQ5Yqf77yM5Y6f5aeL5aSn5bCP77yaJHt0b1NpemUocmVzcC5pbnB1dC5zaXplKX3vvIzljovnvKnlpKflsI/vvJoke3RvU2l6ZShcbiAgICAgICAgICByZXNwLm91dHB1dC5zaXplXG4gICAgICAgICl977yM5Y6L57yp5LqG77yaJHt0b1BlcmNlbnQoXG4gICAgICAgICAgKHJlc3AuaW5wdXQuc2l6ZSAtIHJlc3Aub3V0cHV0LnNpemUpIC8gcmVzcC5pbnB1dC5zaXplXG4gICAgICAgICl9YFxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiWzEvMV1cIiwgYFske2Jhc2VuYW1lfV1gLCBg5Y6L57yp5aSx6LSl77yaJHtlcnJ9YCk7XG4gICAgfVxuICB9IGVsc2UgaWYgKHN0YXRzLmlzRGlyZWN0b3J5KCkpIHtcbiAgICBsZXQgdG90YWwgPSAwO1xuICAgIGxldCBmaW5pc2hlZCA9IDA7XG4gICAgZmlsZUVhY2goZGlyLCBhc3luYyAoZmlsZVBhdGgpID0+IHtcbiAgICAgIGNvbnN0IHJlbGF0aXZlUGF0aCA9IHBhdGguam9pbihiYXNlbmFtZSwgcGF0aC5yZWxhdGl2ZShkaXIsIGZpbGVQYXRoKSk7XG4gICAgICBjb25zdCBmaWxlSGFzaCA9IGdldEZpbGVIYXNoKGZpbGVQYXRoKTtcbiAgICAgIGlmIChjYWNoZVtmaWxlUGF0aF0gPT09IGZpbGVIYXNoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbJHtyZWxhdGl2ZVBhdGh9XSDlt7Lnu4/ljovnvKnov4fvvIzot7Pov4dgKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdG90YWwrKztcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3AgPSBhd2FpdCBmaWxlVGlueShmaWxlUGF0aCk7XG4gICAgICAgIGNhY2hlW2ZpbGVQYXRoXSA9IGdldEZpbGVIYXNoKGZpbGVQYXRoKTtcbiAgICAgICAgc2F2ZUNhY2hlKGNhY2hlKTtcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgYFskeysrZmluaXNoZWR9LyR7dG90YWx9XWAsXG4gICAgICAgICAgYFske3JlbGF0aXZlUGF0aH1dYCxcbiAgICAgICAgICBg5Y6L57yp5oiQ5Yqf77yM5Y6f5aeL5aSn5bCP77yaJHt0b1NpemUocmVzcC5pbnB1dC5zaXplKX3vvIzljovnvKnlpKflsI/vvJoke3RvU2l6ZShcbiAgICAgICAgICAgIHJlc3Aub3V0cHV0LnNpemVcbiAgICAgICAgICApfe+8jOWOi+e8qeS6hu+8miR7dG9QZXJjZW50KFxuICAgICAgICAgICAgKHJlc3AuaW5wdXQuc2l6ZSAtIHJlc3Aub3V0cHV0LnNpemUpIC8gcmVzcC5pbnB1dC5zaXplXG4gICAgICAgICAgKX1gXG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgYFskeysrZmluaXNoZWR9LyR7dG90YWx9XWAsXG4gICAgICAgICAgYFske3JlbGF0aXZlUGF0aH1dYCxcbiAgICAgICAgICBg5Y6L57yp5aSx6LSl77yaJHtlcnJ9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG4iXX0=